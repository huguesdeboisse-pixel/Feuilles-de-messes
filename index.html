<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feuille de Messe ‚Äì G√©n√©rateur</title>
  <style>
    :root {
      --bg: #f7f6f3;
      --card-bg: #ffffff;
      --accent: #8c2f39;
      --text: #2e2e2e;
      --radius: 16px;
      --shadow: 0 4px 16px rgba(0,0,0,0.08);
    }

    body {
      font-family: "Inter", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 2rem;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background: var(--card-bg);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      animation: fadeIn 0.5s ease;
    }

    h1 {
      font-weight: 600;
      text-align: center;
      margin-bottom: 1rem;
      color: var(--accent);
    }

    label {
      display: block;
      margin-top: 1rem;
      font-weight: 500;
    }

    select, input[type="date"] {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #ccc;
      border-radius: var(--radius);
      font-size: 1rem;
      margin-top: 0.3rem;
    }

    button {
      width: 100%;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 0.8rem;
      font-size: 1rem;
      margin-top: 1.5rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      background: #a43d48;
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .cartouche {
      text-align: center;
      margin-top: 1rem;
      padding: 0.6rem 1rem;
      border-radius: var(--radius);
      color: white;
      font-weight: 600;
      display: inline-block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üïäÔ∏è Feuille de Messe</h1>

    <label for="date-messe">Date de la messe :</label>
    <input type="date" id="date-messe">

    <label for="select-rite">Choisissez le rite :</label>
    <select id="select-rite">
      <option value="ordinaire">Rite romain ordinaire</option>
      <option value="extraordinaire">Rite romain extraordinaire</option>
    </select>

    <label for="select-carnet">Choisissez un carnet :</label>
    <select id="select-carnet">
      <option value="">-- S√©lectionnez un carnet --</option>
      <option value="diocese-frejus-toulon">Dioc√®se de Fr√©jus-Toulon</option>
      <option value="chants_par_temps">Chants par temps liturgique</option>
    </select>

    <div id="cartouche-temps" class="cartouche" style="display:none"></div>

    <button id="btn-generer"> G√©n√©rer les suggestions</button>

    <label for="menu-chants">Suggestions :</label>
    <select id="menu-chants">
      <option>-- S√©lectionnez un chant --</option>
    </select>
  </div>

  <script>
    // ===============================
    // üîπ CALCUL DU TEMPS LITURGIQUE
    // ===============================
    function datePaques(annee) {
      const a = annee % 19;
      const b = Math.floor(annee / 100);
      const c = annee % 100;
      const d = Math.floor(b / 4);
      const e = b % 4;
      const f = Math.floor((b + 8) / 25);
      const g = Math.floor((b - f + 1) / 3);
      const h = (19 * a + b - d - g + 15) % 30;
      const i = Math.floor(c / 4);
      const k = c % 4;
      const l = (32 + 2 * e + 2 * i - h - k) % 7;
      const m = Math.floor((a + 11 * h + 22 * l) / 451);
      const mois = Math.floor((h + l - 7 * m + 114) / 31);
      const jour = ((h + l - 7 * m + 114) % 31) + 1;
      return new Date(annee, mois - 1, jour);
    }

    function determinerTempsLiturgique(date = new Date(), rite = "ordinaire") {
      const annee = date.getFullYear();
      const paques = datePaques(annee);
      const mercrediCendres = new Date(paques); mercrediCendres.setDate(paques.getDate() - 46);
      const pentecote = new Date(paques); pentecote.setDate(paques.getDate() + 49);
      const noel = new Date(annee, 11, 25);
      const premierAvent = new Date(noel); premierAvent.setDate(noel.getDate() - 21 - ((noel.getDay() + 6) % 7));

      if (date >= premierAvent && date < noel) return "Avent";
      if (date >= noel && date < new Date(annee + 1, 0, 13)) return "No√´l";
      if (date >= mercrediCendres && date < paques) return "Car√™me";
      if (date >= paques && date < pentecote) return "Temps pascal";
      return "Temps ordinaire";
    }

    // ===============================
    // üîπ CHARGEMENT DES CHANTS
    // ===============================
    async function chargerChants() {
      const dateInput = document.getElementById("date-messe");
      const selectRite = document.getElementById("select-rite");
      const selectCarnet = document.getElementById("select-carnet");
      const menu = document.getElementById("menu-chants");
      const cartouche = document.getElementById("cartouche-temps");

      if (!selectCarnet.value) {
        alert("Veuillez s√©lectionner un carnet.");
        return;
      }

      const date = dateInput.value ? new Date(dateInput.value) : new Date();
      const rite = selectRite.value;
      const temps = determinerTempsLiturgique(date, rite);

      // üé® Couleurs liturgiques
      const couleurs = {
        "Avent": "#5c4b8a",
        "No√´l": "#f0b429",
        "Car√™me": "#6a1b9a",
        "Temps pascal": "#00bfa5",
        "Temps ordinaire": "#388e3c"
      };
      cartouche.style.backgroundColor = couleurs[temps] || "#555";
      cartouche.textContent = `${temps} (${rite === "extraordinaire" ? "forme extraordinaire" : "forme ordinaire"})`;
      cartouche.style.display = "inline-block";

      let chemin = "";
      if (selectCarnet.value === "diocese-frejus-toulon") {
        chemin = "carnets/diocese-frejus-toulon.json";
      } else if (selectCarnet.value === "chants_par_temps") {
        chemin = "carnets/chants_par_temps.json";
      }

      try {
        const response = await fetch(chemin);
        if (!response.ok) throw new Error("Fichier introuvable : " + chemin);
        const data = await response.json();

        // üîç Si c‚Äôest le carnet par temps liturgique :
        const chants = data[temps] || data.chants || [];
        menu.innerHTML = chants.length
          ? chants.map(c => `<option>${c.numero}. ${c.titre}</option>`).join("")
          : `<option>Aucun chant trouv√© pour ${temps}</option>`;

        console.log(`‚úÖ ${chants.length} chants charg√©s depuis ${chemin}`);
      } catch (err) {
        console.error("Erreur :", err);
        menu.innerHTML = `<option>Erreur de chargement (${err.message})</option>`;
      }
    }

    document.getElementById("btn-generer").addEventListener("click", chargerChants);
  </script>

</body>
</html>
